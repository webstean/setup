<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Scale of the Universe - 3D Visualization</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { display: block; }
        
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 40px;
            box-sizing: border-box;
            color: white;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
        }

        header {
            text-align: center;
        }

        h1 {
            font-weight: 300;
            letter-spacing: 5px;
            margin: 0;
            text-transform: uppercase;
            font-size: 1.5rem;
        }

        #info-panel {
            text-align: center;
            margin-top: 20px;
            transition: opacity 0.3s;
        }

        #object-name {
            font-size: 3rem;
            font-weight: 700;
            margin: 0;
            background: linear-gradient(to right, #ffffff, #abaeff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #scale-label {
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            color: #ccc;
            margin-top: 5px;
        }

        #controls {
            pointer-events: auto;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        input[type=range] {
            width: 100%;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.1);
            height: 4px;
            border-radius: 2px;
            outline: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px white;
        }

        .instruction {
            font-size: 0.9rem;
            color: #888;
            margin-top: 10px;
        }

        #loading {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.2rem;
            pointer-events: none;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <div id="loading">Generating Universe...</div>

    <div id="ui-layer">
        <header>
            <h1>Cosmic Scale</h1>
        </header>

        <div id="info-panel">
            <h2 id="object-name">Proton</h2>
            <div id="scale-label">10<sup>-15</sup> meters</div>
        </div>

        <div id="controls">
            <input type="range" id="scaleSlider" min="-16" max="27" step="0.01" value="-15">
            <div class="instruction">Scroll or drag slider to explore</div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';

        // --- Configuration ---
        const SCENE_CONFIG = {
            bgColor: 0x050508,
            fogColor: 0x000000,
            cameraZ: 5 // Fixed camera distance
        };

        // --- State ---
        let currentExponent = -15; // Starting at 10^-15 (Femtometers)
        const objects = []; // Will hold our "ScaleObject" instances

        // --- Setup Three.js ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(SCENE_CONFIG.bgColor);
        scene.fog = new THREE.FogExp2(SCENE_CONFIG.fogColor, 0.15);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = SCENE_CONFIG.cameraZ;

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);

        // --- Lighting ---
        const ambientLight = new THREE.AmbientLight(0x404040, 2); // Soft white light
        scene.add(ambientLight);
        
        const dirLight = new THREE.DirectionalLight(0xffffff, 3);
        dirLight.position.set(1, 1, 2);
        scene.add(dirLight);

        // --- Helper: Texture Generators (Procedural) ---
        // Generates textures on the fly so we don't need external assets
        function createNoiseTexture(color1, color2) {
            const size = 512;
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = color1;
            ctx.fillRect(0,0,size,size);
            
            for(let i=0; i<5000; i++) {
                ctx.fillStyle = color2;
                ctx.globalAlpha = 0.1 + Math.random() * 0.3;
                const x = Math.random() * size;
                const y = Math.random() * size;
                const r = Math.random() * 50;
                ctx.beginPath();
                ctx.arc(x,y,r,0,Math.PI*2);
                ctx.fill();
            }
            const tex = new THREE.CanvasTexture(canvas);
            return tex;
        }

        function createStripedTexture() {
            const size = 512;
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            
            const colors = ['#FF0000', '#FFFFFF', '#0000FF', '#FFFF00', '#00FF00', '#FFFFFF'];
            const segment = size / colors.length;
            
            colors.forEach((c, i) => {
                ctx.fillStyle = c;
                ctx.fillRect(0, i*segment, size, segment + 1);
            });
            
            return new THREE.CanvasTexture(canvas);
        }

        function createGalaxyTexture() {
            const size = 128;
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            
            const grad = ctx.createRadialGradient(size/2, size/2, 0, size/2, size/2, size/2);
            grad.addColorStop(0, 'rgba(255, 255, 255, 1)');
            grad.addColorStop(0.2, 'rgba(200, 200, 255, 0.8)');
            grad.addColorStop(0.5, 'rgba(100, 100, 255, 0.2)');
            grad.addColorStop(1, 'rgba(0, 0, 0, 0)');
            
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, size, size);
            
            return new THREE.CanvasTexture(canvas);
        }

        // --- Object Factory ---
        // Each object has a `baseLog` (power of 10 size) and a `create` function
        
        class ScaleObject {
            constructor(name, power, meshFunction) {
                this.name = name;
                this.power = power; // The 10^x scale where this object lives
                this.group = new THREE.Group();
                meshFunction(this.group);
                scene.add(this.group);
            }

            update(currentExp) {
                // Determine relative scale based on current zoom level
                // If currentExp is equal to this.power, scale is 1.
                // If currentExp is this.power + 1 (zoomed out), scale is 0.1
                const relativeExp = this.power - currentExp;
                const scale = Math.pow(10, relativeExp);

                // Set scale
                this.group.scale.set(scale, scale, scale);

                // Visibility logic (Fade in/out to avoid Z-fighting and visual clutter)
                // We only show objects that are roughly within 0.001 to 100 units of camera scale
                // relativeExp > -3 (scale < 1000) and relativeExp < 2 (scale > 0.01)
                
                const dist = Math.abs(relativeExp);
                if (relativeExp < 2 && relativeExp > -4) {
                    this.group.visible = true;
                    // Rotation animation
                    this.group.rotation.y += 0.002;
                    this.group.rotation.x += 0.001;
                } else {
                    this.group.visible = false;
                }
            }
        }

        // --- 1. Sub-atomic: Proton (10^-15) ---
        objects.push(new ScaleObject("Proton (Nucleus)", -15, (group) => {
            const geo = new THREE.SphereGeometry(1, 32, 32);
            // Three quarks visually represented
            const matRed = new THREE.
